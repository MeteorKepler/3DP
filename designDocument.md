# 3DP - A lightweight program for 3D object loading and viewing 设计文档

![3DP](https://github.com/MeteorKepler/3DP/raw/master/doc/image/3DP.png)

## 环境与平台

* 语言：C++11
* 框架：OpenGL4.5、QT5.9
* 编译器：Visual Studio 2017
* 编译系统：Windows10 64bit

## 配置环境

在win10下安装Visual Studio 2017，然后安装qt5.9，编译器选择msvc2017 64-bit。在VS的扩展和更新下安装QT Visual Studio扩展，并且配置QT版本和路径。

接下来就可以使用vs2017的编译环境和QTDesigner的界面设计进行开发了，如果想直接使用QTCreator做编辑器也可以。

详细配置步骤可以参考我的博客[https://www.meteorshub.com/computer-graphics/2017/11/146/]()。

## 系统架构简述

### QT

QT是一个跨平台的图形界面设计工具，最新版本是QT5.10，在windows的C++下，是很常见的一个图形界面工具，相比于MFC，更简洁和通俗易懂，也更容易进行设计，现在已经很少有用MFC做界面的了。

### OpenGL

OpenGL是一个跨平台的图形应用程序编程接口，最新版本好像到了4.6，不过我的GTX1080仅支持到4.5。跟OpenGL处于竞争关系的就是大名鼎鼎的DirectX。DirectX是微软出的，用于windows下的图形和游戏开发，现在大部分PC平台的大型游戏都是使用的DX接口，最新版是win10支持的DirectX12。不过OpenGL有一点好处就是跨平台，Linux、mac、移动端等都支持。

另外也可以用WebGL编写，web端的界面可能要好设计一点，但考虑到这个项目在本地运行的情景还是要远远多于web端运行，所以最后选择了QT+OpenGL。

## 遇到的问题与解决方案

* 作为电子系转到软院的学生，我之前没有用过OpenGL和QT，因此如何上手就是一件关键的事情。网上的教程因为版本更迭，有的已经年久过时，还有的兼容性不好，还好在youtube找到了几个时效性还不错的视频，在我上手时给了我莫大的帮助。

* 在处理颜色的时候，工程说明里没有讲清楚连续颜色空间和离散颜色空间的区别：

![color mode](https://github.com/MeteorKepler/3DP/raw/master/doc/image/color_mode.png)

示例颜色文件的颜色都是离散的double型，比如1.0，2.0这样的，做离散和做连续都一样。依我的理解，输入颜色值应该是连续的double型，比如1.1，1.21这样。因此我根据示例颜色文件做了修改，每个颜色加上了高斯随机数，以区别离散数值和连续数值对应的图形。

* 另一个遇到的问题是处理高斯滤波时，程序一开始运行非常慢，跑一个一万三角面片的model都要半分钟。因此在优化时着重处理了这一内容的逻辑，先是优化查找邻域点的效率，运行时间降到了8秒，然后优化查找邻域面片的逻辑，运行时间降到4秒，最后优化点法向量计算，最终运行时间降到了1秒以内。解决了这个问题后我发现模型最开始的设计是非常重要的，不然后续可能要花很长时间做优化。

## 心得体会

软件工程的最初设计是很重要的，模型的结构直接决定了软件各个功能的实现。在开始工程的时候，我因为没有仔细考虑模型结构，想当然地写到哪算哪，后来发现很多功能在这个结构下根本无法实现，或者实现的效率很慢，这时候再改动模型结构的代价就相当高了。因此今后再进行有一定规模的项目设计时一定要仔细考虑工程和模型的结构，避免返工。
